<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FinBot Â· BFSI Assistant India</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: linear-gradient(135deg, #e8eef8 0%, #dce8f7 100%); font-family: 'DM Sans', sans-serif; min-height: 100vh; }
    @keyframes bounce {
      0%,80%,100% { transform: translateY(0); }
      40% { transform: translateY(-6px); }
    }
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0%,100% { box-shadow: 0 0 0 0 rgba(0,102,204,0.3); }
      50% { box-shadow: 0 0 0 8px rgba(0,102,204,0); }
    }
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #c5d3e8; border-radius: 10px; }
    .msg-animate { animation: fadeSlideIn 0.3s ease forwards; }
    .chip { cursor: pointer; border: none; transition: background 0.15s; }
    .chip:hover { background: #d0e3fa !important; }
    .send-btn { transition: background 0.2s, transform 0.1s; }
    .send-btn:active { transform: scale(0.93); }
    .action-btn:hover { background: rgba(255,255,255,0.22) !important; }
    textarea:focus { outline: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    // â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const SYSTEM_PROMPT = `You are FinBot, an expert AI assistant for the Indian Banking, Financial Services, and Insurance (BFSI) sector. You assist customers, advisors, and bank staff with clear, accurate, and helpful responses.

Your expertise covers:
- Retail & Corporate Banking (savings, current, FD, RD, loans, credit cards)
- Insurance (life, health, general, term, ULIP, endowment)
- Mutual Funds, SIP, equity, debt instruments, ETFs
- RBI regulations, SEBI guidelines, IRDAI norms
- KYC/AML compliance, account opening procedures
- Digital payments: UPI, NEFT, RTGS, IMPS, NACH, BBPS
- Tax-saving instruments: ELSS, PPF, NPS, 80C/80D deductions
- Credit scores, CIBIL, loan eligibility, EMI calculations
- Stock markets, demat accounts, trading on BSE/NSE
- Startup/SME financing, MSME loans, mudra yojana

Guidelines:
- Always respond in a professional yet friendly tone
- Keep answers concise unless the user asks for more detail
- For investment advice, always add a brief disclaimer: "This is for informational purposes only and not financial advice. Please consult a SEBI-registered advisor."
- If the query involves personal account data (account number, PAN, Aadhaar), politely note that a human agent will assist
- Support both English and Hinglish (mixed Hindi-English) naturally
- Use Indian currency (â‚¹), Indian context (RBI, SEBI, IRDAI, BSE, NSE, NPCI)
- For any signs of financial distress, respond with empathy and refer to iCall: 9152987821`;

    const SUGGESTED = [
      "How do I open a savings account?",
      "What is SIP and how does it work?",
      "How to improve my CIBIL score?",
      "Explain term insurance vs ULIP",
      "How does UPI work?",
      "Tax saving options under 80C",
      "How to apply for a home loan?",
      "What is the difference between NEFT and RTGS?",
    ];

    // â”€â”€ API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function callClaude(history) {
  const contents = history.map(m => ({
    role: m.role === "assistant" ? "model" : "user",
    parts: [{ text: m.content }]
  }));

  const res = await fetch(
    "https://finbot-proxy.rishavchttrj.workers.dev/",
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        system_instruction: { parts: [{ text: SYSTEM_PROMPT }] },
        contents,
      }),
    }
  );
  const data = await res.json();
  if (!res.ok) throw new Error(data.error?.message || "API Error");
  return data.candidates[0]?.content?.parts[0]?.text || "Sorry, I couldn't process that.";
    }

    // â”€â”€ Icons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const SendIcon = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.3" strokeLinecap="round" strokeLinejoin="round">
        <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
      </svg>
    );
    const BotIcon = () => (
      <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        <line x1="12" y1="3" x2="12" y2="7"/>
        <circle cx="9" cy="16" r="1" fill="currentColor"/><circle cx="15" cy="16" r="1" fill="currentColor"/>
      </svg>
    );
    const UserIcon = () => (
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
      </svg>
    );
    const DownloadIcon = () => (
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
      </svg>
    );
    const TrashIcon = () => (
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4h6v2"/>
      </svg>
    );

    // â”€â”€ Typing dots â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const TypingDots = () => (
      <div style={{ display:"flex", gap:5, alignItems:"center", padding:"4px 0" }}>
        {[0,1,2].map(i => (
          <div key={i} style={{
            width:7, height:7, borderRadius:"50%", background:"#0066cc",
            animation:"bounce 1.2s infinite", animationDelay:`${i*0.2}s`
          }}/>
        ))}
      </div>
    );

    // â”€â”€ Message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function Message({ msg }) {
      const isBot = msg.role === "bot";
      return (
        <div className="msg-animate" style={{
          display:"flex", gap:10, marginBottom:16,
          flexDirection: isBot ? "row" : "row-reverse",
        }}>
          <div style={{
            width:34, height:34, borderRadius:"50%", flexShrink:0,
            background: isBot ? "#0066cc" : "#f0f4ff",
            border: isBot ? "none" : "1.5px solid #c7d7f0",
            display:"flex", alignItems:"center", justifyContent:"center",
            color: isBot ? "#fff" : "#0066cc",
          }}>
            {isBot ? <BotIcon/> : <UserIcon/>}
          </div>
          <div style={{
            maxWidth:"76%",
            background: isBot ? "#fff" : "#0066cc",
            color: isBot ? "#1a2340" : "#fff",
            borderRadius: isBot ? "0 14px 14px 14px" : "14px 0 14px 14px",
            padding:"12px 16px",
            fontSize:14.5, lineHeight:1.65,
            boxShadow: isBot ? "0 1px 6px rgba(0,0,0,0.07)" : "0 2px 10px rgba(0,102,204,0.25)",
            whiteSpace:"pre-wrap",
            fontFamily:"'Lora', Georgia, serif",
          }}>
            {msg.content}
            {msg.time && (
              <div style={{ fontSize:11, marginTop:6, opacity:0.5, textAlign:"right", fontFamily:"monospace" }}>
                {msg.time}
              </div>
            )}
          </div>
        </div>
      );
    }

    // â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function App() {
      const sessionId = useRef(`session_${Date.now()}`).current;
      const now = () => new Date().toLocaleTimeString("en-IN", { hour:"2-digit", minute:"2-digit" });

      const [messages, setMessages] = useState([{
        role:"bot",
        content:"Namaste! ðŸ™ I'm FinBot, your BFSI assistant for Indian banking, insurance, and investments.\n\nAsk me anything â€” accounts, loans, mutual funds, UPI, insurance, tax saving, and more. How can I help you today?",
        time: now(),
      }]);
      const [input, setInput] = useState("");
      const [loading, setLoading] = useState(false);
      const bottomRef = useRef(null);
      const inputRef = useRef(null);
      const textareaRef = useRef(null);

      useEffect(() => {
        bottomRef.current?.scrollIntoView({ behavior:"smooth" });
      }, [messages, loading]);

      async function send(text) {
        const msg = text || input.trim();
        if (!msg || loading) return;
        setInput("");
        if (textareaRef.current) textareaRef.current.style.height = "auto";

        const userMsg = { role:"user", content:msg, time:now() };
        const next = [...messages, userMsg];
        setMessages(next);
        setLoading(true);

        try {
          const history = next.map(m => ({
            role: m.role === "bot" ? "assistant" : "user",
            content: m.content,
          }));
          const reply = await callClaude(history);
          setMessages(prev => [...prev, { role:"bot", content:reply, time:now() }]);
        } catch(e) {
          setMessages(prev => [...prev, {
            role:"bot",
            content:"âš ï¸ Connection issue. Please check your network and try again.",
            time:now(),
          }]);
        } finally {
          setLoading(false);
          setTimeout(() => inputRef.current?.focus(), 100);
        }
      }

      function clearChat() {
        setMessages([{ role:"bot", content:"Chat cleared. How can I assist you today?", time:now() }]);
      }

      function exportSession() {
        const payload = {
          sessionId,
          exportedAt: new Date().toISOString(),
          source: "finbot-web",
          meta: { industry:"BFSI", region:"IN", language:"en" },
          messages: messages.map((m,i) => ({
            id: i, role: m.role, content: m.content, time: m.time
          })),
        };
        const blob = new Blob([JSON.stringify(payload, null, 2)], { type:"application/json" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `finbot-${sessionId}.json`;
        a.click();
      }

      return (
        <div style={{
          minHeight:"100vh", display:"flex", alignItems:"center",
          justifyContent:"center", padding:16,
        }}>
          <div style={{
            width:"100%", maxWidth:720,
            background:"#f5f7fc",
            borderRadius:24,
            boxShadow:"0 8px 40px rgba(0,30,100,0.13)",
            display:"flex", flexDirection:"column",
            height:"90vh", maxHeight:820, overflow:"hidden",
          }}>

            {/* Header */}
            <div style={{
              background:"linear-gradient(135deg, #003d99 0%, #0066cc 100%)",
              padding:"18px 22px",
              display:"flex", alignItems:"center", justifyContent:"space-between",
            }}>
              <div style={{ display:"flex", alignItems:"center", gap:12 }}>
                <div style={{
                  width:44, height:44, background:"rgba(255,255,255,0.15)",
                  borderRadius:12, display:"flex", alignItems:"center", justifyContent:"center",
                  animation:"pulse 2.5s infinite",
                }}>
                  <BotIcon/>
                </div>
                <div>
                  <div style={{ color:"#fff", fontWeight:600, fontSize:17, letterSpacing:0.3 }}>FinBot</div>
                  <div style={{ color:"rgba(255,255,255,0.65)", fontSize:12 }}>BFSI Assistant Â· India</div>
                </div>
              </div>
              <div style={{ display:"flex", gap:8 }}>
                <button className="action-btn" onClick={exportSession} style={{
                  background:"rgba(255,255,255,0.13)", color:"#fff", borderRadius:8,
                  padding:"7px 13px", fontSize:12, fontFamily:"'DM Sans',sans-serif",
                  display:"flex", alignItems:"center", gap:6, cursor:"pointer",
                  border:"none",
                }}>
                  <DownloadIcon/> Export
                </button>
                <button className="action-btn" onClick={clearChat} style={{
                  background:"rgba(255,255,255,0.13)", color:"#fff", borderRadius:8,
                  padding:"7px 10px", display:"flex", alignItems:"center", cursor:"pointer",
                  border:"none",
                }}>
                  <TrashIcon/>
                </button>
              </div>
            </div>

            {/* Status bar */}
            <div style={{
              background:"#e8f0fa", padding:"7px 22px",
              display:"flex", alignItems:"center", justifyContent:"space-between",
              borderBottom:"1px solid #d0def5",
            }}>
              <div style={{ display:"flex", alignItems:"center", gap:7, fontSize:12, color:"#4a6090" }}>
                <div style={{ width:7, height:7, background:"#22c55e", borderRadius:"50%" }}/>
                Online Â· Powered by Gemini AI
              </div>
              <div style={{ fontSize:11, color:"#8096b8", fontFamily:"monospace" }}>
                {sessionId.slice(0,22)}â€¦
              </div>
            </div>

            {/* Messages */}
            <div style={{ flex:1, overflowY:"auto", padding:"20px 22px 8px" }}>
              {messages.map((msg,i) => <Message key={i} msg={msg}/>)}
              {loading && (
                <div style={{ display:"flex", gap:10, marginBottom:16 }}>
                  <div style={{
                    width:34, height:34, borderRadius:"50%", background:"#0066cc",
                    display:"flex", alignItems:"center", justifyContent:"center",
                    flexShrink:0, color:"#fff",
                  }}>
                    <BotIcon/>
                  </div>
                  <div style={{
                    background:"#fff", borderRadius:"0 14px 14px 14px",
                    padding:"12px 16px", boxShadow:"0 1px 4px rgba(0,0,0,0.07)",
                  }}>
                    <TypingDots/>
                  </div>
                </div>
              )}
              <div ref={bottomRef}/>
            </div>

            {/* Suggestion chips â€” only at start */}
            {messages.length <= 1 && (
              <div style={{ padding:"0 22px 12px" }}>
                <div style={{ fontSize:12, color:"#8096b8", marginBottom:8, fontWeight:500 }}>
                  Quick questions:
                </div>
                <div style={{ display:"flex", gap:8, flexWrap:"wrap" }}>
                  {SUGGESTED.map((q,i) => (
                    <button key={i} className="chip" onClick={() => send(q)} style={{
                      background:"#e8f0fa", color:"#0052a3",
                      border:"1px solid #c7d7f0", borderRadius:20,
                      padding:"6px 14px", fontSize:12.5,
                      fontFamily:"'DM Sans',sans-serif",
                    }}>
                      {q}
                    </button>
                  ))}
                </div>
              </div>
            )}

            {/* Input area */}
            <div style={{ padding:"12px 18px 16px", borderTop:"1px solid #d8e4f5", background:"#f5f7fc" }}>
              <div style={{
                display:"flex", gap:10, alignItems:"flex-end",
                background:"#fff", borderRadius:16,
                border:"1.5px solid #c7d7f0",
                padding:"8px 8px 8px 16px",
                boxShadow:"0 1px 6px rgba(0,50,150,0.06)",
              }}>
                <textarea
                  ref={el => { inputRef.current = el; textareaRef.current = el; }}
                  value={input}
                  onChange={e => setInput(e.target.value)}
                  onKeyDown={e => {
                    if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); send(); }
                  }}
                  onInput={e => {
                    e.target.style.height = "auto";
                    e.target.style.height = Math.min(e.target.scrollHeight, 100) + "px";
                  }}
                  placeholder="Ask about loans, insurance, mutual funds, UPIâ€¦"
                  rows={1}
                  disabled={loading}
                  style={{
                    flex:1, resize:"none", border:"none", background:"transparent",
                    fontSize:14.5, lineHeight:1.5, color:"#1a2340",
                    fontFamily:"'DM Sans',sans-serif",
                    maxHeight:100, overflowY:"auto",
                  }}
                />
                <button
                  className="send-btn"
                  onClick={() => send()}
                  disabled={loading || !input.trim()}
                  style={{
                    background: (loading || !input.trim()) ? "#c7d7f0" : "#0066cc",
                    color:"#fff", width:40, height:40, borderRadius:12,
                    display:"flex", alignItems:"center", justifyContent:"center",
                    flexShrink:0, cursor: (loading || !input.trim()) ? "not-allowed" : "pointer",
                    border:"none",
                  }}
                >
                  <SendIcon/>
                </button>
              </div>
              <div style={{ fontSize:11, color:"#aab8cc", textAlign:"center", marginTop:8 }}>
                FinBot may make errors. Not financial advice. Regulated domain: SEBI Â· IRDAI Â· RBI
              </div>
            </div>

          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
